# Trip Diary Backend

## 如何开发

```bash
pnpm install
```

```bash
npx prisma generate
```

```bash
pnpm run start:dev
```

## 如何初始化

复制 `.env.example` 到 `.env` 并修改配置

```bash
cp .env.example .env
```

```bash
npx prisma migrate dev --name init
```

## 其他

### 生成模拟数据

```bash
pnpm run db:seed
```

## 日记推荐算法说明

本项目的推荐接口（`GET /diary/recommend`）实现了类似小红书首页的日记推荐功能，支持个性化与通用推荐。推荐算法设计如下：

### 1. 推荐逻辑概述

- **未登录用户**：直接推荐全站热门日记，按点赞数、浏览量、发布时间降序排序。
- **已登录用户**：优先推荐与用户点赞过的日记的标签（Tag）相关的日记，排除用户已点赞的日记，按热度排序。不足部分用全站热门日记补齐。如果推荐数量仍不足，则继续补充用户已点赞过的热门日记，保证推荐条数尽量填满。

### 2. 详细流程

#### 2.1 未登录用户

1. 查询所有已发布且审核通过的日记。
2. 按 `likeCount`、`viewCount`、`publishedAt` 降序排序。
3. 支持分页返回。

#### 2.2 已登录用户

1. 获取用户点赞过的所有日记的标签（Tag）。
2. 查询含有这些标签的其他已发布且审核通过的日记，**排除用户已点赞的日记**。
3. 按 `likeCount`、`viewCount`、`publishedAt` 降序排序，分页返回。
4. 如果推荐数量不足，则补充全站热门日记（同未登录逻辑，排除已推荐和已点赞的）。
5. 如果推荐数量仍不足，再补充用户已点赞过的热门日记，避免重复，保证推荐条数尽量达到 size。

### 3. 算法优点

- **个性化**：已登录用户能看到与自己兴趣相关的内容，提升粘性。
- **热度优先**：新用户或无兴趣画像时，依然能看到优质热门内容。
- **实时性**：推荐内容随用户点赞行为动态变化。
- **兜底保障**：即使日记数量很少，也能尽量补齐推荐条数。

### 4. 接口参数

- `page`：页码，默认1
- `size`：每页数量，默认10，最大100

### 5. 可扩展性

- 可进一步引入用户浏览、收藏、关注等行为，丰富兴趣画像。
- 可引入协同过滤、内容相似度等更复杂的推荐算法。
- 支持更多筛选条件（如屏蔽、黑名单、内容安全等）。
